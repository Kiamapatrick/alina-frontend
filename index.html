<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alina906Vibes — Rentals</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
   <link rel="stylesheet" href="css/new.css" />



</head>

<body>
  <!-- Header -->
  <header class="py-3">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="brand">Alina906Vibes</div>
      <nav class="d-flex align-items-center">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a id="loginLink" href="login.html" class="btn btn-outline-success ms-3">Sign In</a>
        <a id="signupLink" href="signup.html" class="btn btn-success ms-2">Sign Up</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <h1>Featured Rentals</h1>
    <p>Browse verified properties and check availability instantly using your connected wallet.</p>
  </section>

  <!-- Rentals -->
  <main class="container-fluid px-3 px-lg-4 pb-5">
    <div id="unitsContainer" class="row g-4"></div>
    <div id="unitsEmpty" style="display:none;">No units available.</div>
  </main>

  <!-- Footer -->
  <footer>
    Built on Polygon Amoy Testnet | © 2025 Alina906Vibes
  </footer>


  <!-- scripts -->
  <script type="module">
    // index client logic — module so imports would be possible later if needed
    const BACKEND = window.BACKEND_URL || '';

    // hide signup/login if token exists
    const token = localStorage.getItem("userToken");
    if (token) {
      const login = document.getElementById("loginLink");
      const signup = document.getElementById("signupLink");
      if (login) login.style.display = "none";
      if (signup) signup.style.display = "none";
    }

    // safe image src builder
    function imageSrcFromUnit(unit) {
      if (!unit || !unit.image) return '/img/placeholder.jpg';
      const img = unit.image;
      if (img.startsWith('http://') || img.startsWith('https://')) return img;
      if (img.startsWith('/')) return img; // already absolute
      // common case: filename or "img/xxx.jpg" -> ensure prefix /img/
      return img.startsWith('img/') ? '/' + img : '/img/' + img;
    }

    function createCard(unit) {
      const a = document.createElement('a');
      a.href = `booking.html?id=${unit._id}`;
      a.className = 'text-decoration-none text-dark';

      const card = document.createElement('div');
      card.className = 'card h-100 shadow-sm rental-card';

      const img = document.createElement('img');
      img.className = 'card-img-top';
      img.alt = unit.name || 'Rental';
      img.src = imageSrcFromUnit(unit);

      const body = document.createElement('div');
      body.className = 'card-body';

      const title = document.createElement('h5');
      title.className = 'card-title mb-1';
      title.textContent = unit.name || 'Unnamed unit';

      const desc = document.createElement('p');
      desc.className = 'card-text text-muted small mb-2';
      desc.textContent = unit.description || '';

      const meta = document.createElement('div');
      meta.className = 'd-flex justify-content-between align-items-center mb-2';
      meta.innerHTML = `<div class="small">${unit.location || ''}</div><div class="fw-bold small">$${unit.pricePerNight || '35'}/night</div>`;

      const btn = document.createElement('div');
      btn.className = 'd-grid';
      btn.innerHTML = `
  <button class="btn btn-success w-100 rounded-pill">
    View Rental
  </button>
`;

      body.appendChild(title);
      body.appendChild(desc);
      body.appendChild(meta);
      body.appendChild(btn);

      card.appendChild(img);
      card.appendChild(body);
      a.appendChild(card);
      return a;
    }

    
    async function loadUnits() {
      const container = document.getElementById('unitsContainer');
      const empty = document.getElementById('unitsEmpty');
      try {
const API_BASE = window.location.hostname === "localhost"
  ? "http://localhost:5000"
  : "https://alina906vibes-backend.onrender.com";

const res = await fetch(`${API_BASE}/units`);
        if (!res.ok) throw new Error('units fetch failed ' + res.status);
        const units = await res.json();
        container.innerHTML = '';
        if (!Array.isArray(units) || units.length === 0) {
          empty.style.display = 'block';
          return;
        }
        empty.style.display = 'none';
        units.forEach(u => {
          const card = createCard(u);
const col = document.createElement('div');
col.className = 'col-12 col-md-6 col-lg-4 mb-4';
col.appendChild(card);
container.appendChild(col);
        });
      } catch (err) {
        console.error('Failed to load units:', err);
        container.innerHTML = '<div class="text-danger">Failed to load rentals.</div>';
      }
    }

    
    // initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadUnits();
    });
  </script>
  <script src="js/nav.js"></script>
</body>
</html>
