<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alina906Vibes â€” Rentals</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/new.css" />
  <link rel="stylesheet" href="css/navbar.css" />
</head>

<body>
  <!-- â•â•â• Premium Navbar â•â•â• -->
  <nav id="mainNavbar" class="alina-navbar">
    <div class="navbar-inner">
      <!-- Row 1: Logo + Nav Links -->
      <div class="navbar-row1">
        <a class="navbar-logo" href="index.html">Alina<span>906</span>Vibes</a>
        <ul class="navbar-links">
          <li><a href="index.html" data-page="index">Home</a></li>
          <li><a href="about.html" data-page="about">About</a></li>
          <li><a href="contact.html" data-page="contact">Contact</a></li>
        </ul>
      </div>

      <!-- Row 2 (mobile) / inline (desktop): Auth + Wallet -->
      <div class="navbar-row2">
        <div class="navbar-actions">
          <!-- Welcome greeting (shown when logged in on mobile) -->
          <span class="nav-welcome" id="navWelcome"></span>

          <a id="loginLink" href="login.html" class="nav-btn nav-btn-outline">Sign In</a>
          <a id="signupLink" href="signup.html" class="nav-btn nav-btn-solid">Sign Up</a>

          <div class="wallet-area" id="navWalletWrapper">
            <button id="connectWallet" class="wallet-connect-btn">
              <span class="wallet-icon">ğŸ¦Š</span> Connect Wallet
            </button>
            <div id="walletInfoRow" class="wallet-connected" style="display:none;">
              <span class="wallet-status-dot"></span>
              <span id="walletAddress" class="wallet-addr">â€”</span>
              <button id="disconnectWallet" class="wallet-disconnect-btn">âœ•</button>
            </div>
          </div>

          <div id="avatarDropdown" class="avatar-area" style="display:none;">
            <button class="avatar-btn" id="avatarToggle">
              <span class="avatar-initials" id="avatarInitials">?</span>
              <span class="avatar-name" id="avatarName">User</span>
            </button>
            <div class="avatar-menu" id="avatarMenu">
              <a href="my_booking.html" class="avatar-menu-item">ğŸ“‹ My Bookings</a>
              <a href="#" class="avatar-menu-item">ğŸ‘¤ Account</a>
              <div class="avatar-menu-item kyc-status-item">
                ğŸ›¡ï¸ KYC Status <span id="kycBadge" class="kyc-badge">â€”</span>
              </div>
              <hr class="avatar-menu-divider">
              <button id="logoutBtn" class="avatar-menu-item logout-item">ğŸšª Log Out</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>


  <!-- Hero -->
  <section class="hero">
    <h1>Featured Rentals</h1>
    <p>Browse verified properties and check availability instantly using your connected wallet.</p>
  </section>

  <!-- Rentals -->
  <main class="container-fluid px-3 px-lg-4 pb-5">
    <div id="unitsContainer" class="row g-4"></div>
    <div id="unitsEmpty" style="display:none;">No units available.</div>
  </main>

  <!-- Footer -->
  <footer>
    Built on Polygon Amoy Testnet | Â© 2025 Alina906Vibes
  </footer>


  <!-- scripts -->
  <script type="module">
    const BACKEND = window.BACKEND_URL || '';

    // safe image src builder
    function imageSrcFromUnit(unit) {
      if (!unit || !unit.image) return '/img/placeholder.jpg';
      const img = unit.image;
      if (img.startsWith('http://') || img.startsWith('https://')) return img;
      if (img.startsWith('/')) return img; // already absolute
      // common case: filename or "img/xxx.jpg" -> ensure prefix /img/
      return img.startsWith('img/') ? '/' + img : '/img/' + img;
    }

    function createCard(unit) {
      const a = document.createElement('a');
      a.href = `booking.html?id=${unit._id}`;
      a.className = 'text-decoration-none text-dark';

      const card = document.createElement('div');
      card.className = 'card h-100 shadow-sm rental-card';

      const img = document.createElement('img');
      img.className = 'card-img-top';
      img.alt = unit.name || 'Rental';
      img.src = imageSrcFromUnit(unit);

      const body = document.createElement('div');
      body.className = 'card-body';

      const title = document.createElement('h5');
      title.className = 'card-title mb-1';
      title.textContent = unit.name || 'Unnamed unit';

      const desc = document.createElement('p');
      desc.className = 'card-text text-muted small mb-2';
      desc.textContent = unit.description || '';

      const meta = document.createElement('div');
      meta.className = 'd-flex justify-content-between align-items-center mb-2';
      meta.innerHTML = `<div class="small">${unit.location || ''}</div><div class="fw-bold small">$${unit.pricePerNight || '35'}/night</div>`;

      const btn = document.createElement('div');
      btn.className = 'd-grid';
      btn.innerHTML = `
  <button class="btn btn-success w-100 rounded-pill">
    View Rental
  </button>
`;

      body.appendChild(title);
      body.appendChild(desc);
      body.appendChild(meta);
      body.appendChild(btn);

      card.appendChild(img);
      card.appendChild(body);
      a.appendChild(card);
      return a;
    }


    async function loadUnits() {
      const container = document.getElementById('unitsContainer');
      const empty = document.getElementById('unitsEmpty');
      try {
        const API_BASE = window.location.hostname === "localhost"
          ? "http://localhost:5000"
          : "https://alina906vibes-backend.onrender.com";

        const res = await fetch(`${API_BASE}/units`);
        if (!res.ok) throw new Error('units fetch failed ' + res.status);
        const units = await res.json();
        container.innerHTML = '';
        if (!Array.isArray(units) || units.length === 0) {
          empty.style.display = 'block';
          return;
        }
        empty.style.display = 'none';
        units.forEach(u => {
          const card = createCard(u);
          const col = document.createElement('div');
          col.className = 'col-12 col-md-6 col-lg-4 mb-4';
          col.appendChild(card);
          container.appendChild(col);
        });
      } catch (err) {
        console.error('Failed to load units:', err);
        container.innerHTML = '<div class="text-danger">Failed to load rentals.</div>';
      }
    }


    // initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadUnits();
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"></script>
  <script src="js/nav.js"></script>
</body>

</html>